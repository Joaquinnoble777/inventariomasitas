<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inventario de Confitería</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <h1 class="mb-4 text-center">Inventario de Confitería</h1>

    <!-- Pestañas -->
    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="inventario-tab" data-bs-toggle="tab" data-bs-target="#inventario" type="button">Inventario</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="ventas-tab" data-bs-toggle="tab" data-bs-target="#ventas" type="button">Ventas</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard" type="button">Dashboard</button>
      </li>
    </ul>

    <div class="tab-content mt-3">
      <!-- INVENTARIO -->
      <div class="tab-pane fade show active" id="inventario" role="tabpanel">
        <!-- Tabla de inventario -->
        <table class="table table-bordered table-striped" id="inventarioTable">
          <thead class="table-dark">
            <tr>
              <th>Producto</th>
              <th>Cantidad</th>
              <th>Precio Unitario ($)</th>
              <th>Subtotal ($)</th>
              <th>Acción</th>
            </tr>
          </thead>
          <tbody></tbody>
          <tfoot>
            <tr>
              <th colspan="3" class="text-end">Total:</th>
              <th id="total">0</th>
              <th></th>
            </tr>
          </tfoot>
        </table>

        <!-- Formulario para agregar productos -->
        <div class="card p-4 mt-4">
          <h4>Agregar Producto</h4>
          <div class="row g-2">
            <div class="col-md-3">
              <input type="text" id="productoNombre" class="form-control" placeholder="Nombre del producto">
            </div>
            <div class="col-md-2">
              <input type="number" id="productoCantidad" class="form-control" placeholder="Cantidad" min="1">
            </div>
            <div class="col-md-2">
              <input type="number" id="productoPrecio" class="form-control" placeholder="Precio unitario" min="0">
            </div>
            <div class="col-md-2">
              <button class="btn btn-success w-100" onclick="agregarProducto()">Agregar</button>
            </div>
          </div>
        </div>
      </div>

      <!-- VENTAS -->
      <div class="tab-pane fade" id="ventas" role="tabpanel">
        <h3 class="mt-3">Productos Vendidos</h3>
        <table class="table table-bordered table-striped" id="ventasTable">
          <thead class="table-dark">
            <tr>
              <th>Producto</th>
              <th>Precio Costo ($)</th>
              <th>Precio Venta ($)</th>
              <th>Ganancia ($)</th>
              <th>Cliente</th>
            </tr>
          </thead>
          <tbody></tbody>
          <tfoot>
            <tr>
              <th colspan="3" class="text-end">Ganancia Total:</th>
              <th id="gananciaTotal">0</th>
              <th></th>
            </tr>
          </tfoot>
        </table>
      </div>

      <!-- DASHBOARD -->
      <div class="tab-pane fade" id="dashboard" role="tabpanel">
        <h3 class="mt-3">Resumen General</h3>
        <ul class="list-group mt-3">
          <li class="list-group-item">Total inventario: <span id="totalInventario">0</span> $</li>
          <li class="list-group-item">Ganancia total: <span id="totalGanancia">0</span> $</li>
          <li class="list-group-item">Cantidad total de productos: <span id="totalProductos">0</span></li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    // Cargar inventario y ventas desde localStorage o usar valores iniciales
    let inventario = JSON.parse(localStorage.getItem('inventario')) || [
      { nombre: "Bandeja de ojitos medianos", cantidad: 2, precio: 150 },
      { nombre: "Bandeja de alfajor de maicena mediano", cantidad: 1, precio: 240 },
      { nombre: "Pasta flora", cantidad: 2, precio: 130 },
      { nombre: "Bandeja de merengue", cantidad: 3, precio: 250 },
      { nombre: "Bandeja de yoyó", cantidad: 1, precio: 240 },
      { nombre: "Bandeja de espejito", cantidad: 4, precio: 250 },
      { nombre: "Bandeja alemana", cantidad: 2, precio: 240 },
      { nombre: "Bandeja de ojitos grandes", cantidad: 2, precio: 240 },
      { nombre: "Bandeja de alfajor de chocolate con maní", cantidad: 2, precio: 360 }
    ];

    let ventas = JSON.parse(localStorage.getItem('ventas')) || [];

    function guardarDatos() {
      localStorage.setItem('inventario', JSON.stringify(inventario));
      localStorage.setItem('ventas', JSON.stringify(ventas));
    }

    function mostrarInventario() {
      const tbody = document.querySelector("#inventarioTable tbody");
      tbody.innerHTML = "";
      let total = 0;
      let totalProductos = 0;

      inventario.forEach((item, index) => {
        const subtotal = item.cantidad * item.precio;
        total += subtotal;
        totalProductos += item.cantidad;

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${item.nombre}</td>
          <td>${item.cantidad}</td>
          <td>${item.precio}</td>
          <td>${subtotal}</td>
          <td>
            <button class="btn btn-danger btn-sm" onclick="eliminarProducto(${index})">Eliminar</button>
            <button class="btn btn-primary btn-sm ms-1" onclick="venderProducto(${index})">Vender</button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      document.getElementById("total").innerText = total;

      // Actualizar dashboard
      document.getElementById("totalInventario").innerText = total;
      document.getElementById("totalProductos").innerText = totalProductos;
    }

    function mostrarVentas() {
      const tbody = document.querySelector("#ventasTable tbody");
      tbody.innerHTML = "";
      let gananciaTotal = 0;

      ventas.forEach(item => {
        const ganancia = item.precioVenta - item.precio;
        gananciaTotal += ganancia;

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${item.nombre}</td>
          <td>${item.precio}</td>
          <td>${item.precioVenta}</td>
          <td>${ganancia}</td>
          <td>${item.cliente}</td>
        `;
        tbody.appendChild(tr);
      });

      document.getElementById("gananciaTotal").innerText = gananciaTotal;
      document.getElementById("totalGanancia").innerText = gananciaTotal;
    }

    function agregarProducto() {
      const nombre = document.getElementById("productoNombre").value.trim();
      const cantidad = parseInt(document.getElementById("productoCantidad").value);
      const precio = parseInt(document.getElementById("productoPrecio").value);

      if (!nombre || cantidad <= 0 || precio < 0) {
        alert("Por favor, complete todos los campos correctamente.");
        return;
      }

      inventario.push({ nombre, cantidad, precio });
      document.getElementById("productoNombre").value = "";
      document.getElementById("productoCantidad").value = "";
      document.getElementById("productoPrecio").value = "";

      guardarDatos();
      mostrarInventario();
    }

    function eliminarProducto(index) {
      inventario.splice(index, 1);
      guardarDatos();
      mostrarInventario();
    }

    function venderProducto(index) {
      const cliente = prompt("Ingrese el nombre del cliente:");
      if (!cliente) return;

      const producto = inventario[index];
      const precioVenta = producto.precio + 50;

      ventas.push({ nombre: producto.nombre, precio: producto.precio, precioVenta, cliente });
      
      producto.cantidad -= 1;
      if (producto.cantidad <= 0) {
        inventario.splice(index, 1);
      }

      guardarDatos();
      mostrarInventario();
      mostrarVentas();
    }

    mostrarInventario();
    mostrarVentas();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
